% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mcmc_bt_sbm.R
\name{gibbs_bt_sbm}
\alias{gibbs_bt_sbm}
\title{Gibbs sampler for a Bradley–Terry Stochastic Block Model}
\usage{
gibbs_bt_sbm(
  w_ij,
  n_ij,
  a,
  b,
  prior = "DP",
  alpha_PY = NA,
  sigma_PY = NA,
  beta_DM = NA,
  H_DM = NA,
  gamma_GN = NA,
  n_iter = 2000,
  burnin = 1000,
  init_x = NULL,
  store_z = FALSE,
  verbose = TRUE
)
}
\arguments{
\item{w_ij}{integer/numeric K x K matrix of wins from i over j (diagonal ignored).}

\item{n_ij}{integer/numeric K x K matrix of total matches between i and j (symmetric, diag 0).}

\item{a}{numeric(1). Shape for the Gamma(a, b) prior on each block rate at init; updated inside.}

\item{b}{numeric(1). Rate for the Gamma(a, b) prior (fixed).}

\item{prior}{character(1). One of \code{c("DP","PY","DM","GN")}.}

\item{alpha_PY}{numeric(1) or \code{NA}. Concentration for DP/PY (must be > 0 when used).}

\item{sigma_PY}{numeric(1) or \code{NA}. Discount for PY in [0,1); set 0 for DP if using "PY".}

\item{beta_DM}{numeric(1) or \code{NA}. Dirichlet-Multinomial concentration (>0) if \code{prior="DM"}.}

\item{H_DM}{integer(1) or \code{NA}. Max # clusters for DM (>=1) if \code{prior="DM"}.}

\item{gamma_GN}{numeric(1) or \code{NA}. Parameter for Gnedin if \code{prior="GN"}.}

\item{n_iter}{integer(1). Total MCMC iterations.}

\item{burnin}{integer(1). Number of initial iterations to discard (must be < n_iter).}

\item{init_x}{integer vector of length K with initial cluster labels (1..K), or \code{NULL}.}

\item{store_z}{logical(1). If TRUE, store the latent Z matrices.}

\item{verbose}{logical(1). If TRUE, print progress every 200 iters.}

\item{a_prior_draw}{function with signature \code{function() numeric(1)}. Draws a proposal from the prior of \eqn{a} (Damien slice sampler). Default is \code{function() rexp(1, 1)} (Exp(1) on \eqn{a>0}).}

\item{a_prior_support}{function with signature \code{function(a) logical(1)}. Checks support of \eqn{a}. Default: \code{function(a) a > 0}.}
}
\value{
A list with:
\item{x_samples}{(n_save x K) integer matrix of cluster labels after burn-in.}
\item{lambda_samples}{(n_save x K) numeric matrix of block rates (entries for empty labels can be unused).}
\item{z_samples}{optional (n_save x K x K) array of latent \eqn{Z_{ij}} if \code{store_z=TRUE}.}
}
\description{
Runs a Gibbs sampler for a BT–SBM with a Gamma(a, b) prior on block rates
and a choice of clustering prior (DP, Pitman–Yor, Dirichlet–Multinomial, or Gnedin).
}
\details{
\itemize{
\item The sampler uses Gamma-Poisson augmentation for the BT likelihood: \eqn{Z_{ij} \sim \mathrm{Gamma}(n_{ij}, \lambda_{x_i}+\lambda_{x_j})}.
\item Cluster reassignment uses a one-step CRP/PY/DM/GN urn with a marginal new-cluster integral under \eqn{\lambda \sim \mathrm{Gamma}(a,b)}.
\item \eqn{a} is updated via a Damien-style slice move on the joint of \eqn{\lambda} given \eqn{b} and the prior on \eqn{a}.
}
}
\examples{
\dontrun{
set.seed(1)
K <- 6
w <- matrix(0, K, K); n <- matrix(0, K, K)
n[upper.tri(n)] <- sample(0:5, sum(upper.tri(n)), TRUE)
n <- n + t(n); diag(n) <- 0
w[upper.tri(w)] <- rbinom(sum(upper.tri(w)), size = n[upper.tri(n)], prob = 0.5)
w <- w + t(n - w); diag(w) <- 0
out <- gibbs_bt_sbm(w, n, a = 1, b = 1, prior = "DP", alpha_PY = 1,
                    n_iter = 500, burnin = 250, verbose = FALSE)
str(out)
}
}

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with BTSBM: the R package for the BT-SBM paper • BTSBM: Bradley–Terry Stochastic Block Model</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with BTSBM: the R package for the BT-SBM paper">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BTSBM: Bradley–Terry Stochastic Block Model</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting started with BTSBM: the R package for the BT-SBM paper</a>
    </li>
    <li>
      <a href="../articles/Notation.html">Notation and Object Dimensions for the Bradley–Terry Stochastic Block Model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/laposanti/BTSBM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="getting-started_files/kePrint-0.0.1/kePrint.js"></script><link href="getting-started_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started with BTSBM: the R package for
the BT-SBM paper</h1>
                        <h4 data-toc-skip class="author">Lapo Santi</h4>
            
            <h4 data-toc-skip class="date">2025-10-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/laposanti/BTSBM/blob/main/vignettes/getting-started.Rmd" class="external-link"><code>vignettes/getting-started.Rmd</code></a></small>
      <div class="hidden name"><code>getting-started.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette shows a minimal workflow with the <code>BTSBM</code>
functions. We take the 2017 Men’s ATP season, as in the paper for
convenience.</p>
<div class="section level3">
<h3 id="set-up-the-data">Set up the data<a class="anchor" aria-label="anchor" href="#set-up-the-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#choosing the 2017 season</span></span>
<span><span class="va">w_ij</span> <span class="op">=</span> <span class="va">ATP_2000_2022</span><span class="op">$</span><span class="va">`2017`</span><span class="op">$</span><span class="va">Y_ij</span></span>
<span></span>
<span><span class="co">#quick look at the matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">w_ij</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                 Rafael_Nadal Roger_Federer Grigor_Dimitrov</span></span>
<span><span class="co">#&gt; Rafael_Nadal               0             0               3</span></span>
<span><span class="co">#&gt; Roger_Federer              4             0               1</span></span>
<span><span class="co">#&gt; Grigor_Dimitrov            0             0               0</span></span></code></pre>
<p>Each entry (<code>w_{ij}</code>) counts how many matches player
(<code>i</code>) won against (<code>j</code>) in the chosen season. The
matrix is directed (wins aren’t symmetric), and the diagonal is zero by
design. In practice, sparse rows/columns correspond to players with few
matches.</p>
</div>
<div class="section level3">
<h3 id="set-the-prior-hyperparameters">Set the prior Hyperparameters<a class="anchor" aria-label="anchor" href="#set-the-prior-hyperparameters"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Gamma hyper.</span></span>
<span><span class="va">a_strength</span> <span class="op">=</span> <span class="fl">2</span> <span class="co"># robust choice</span></span></code></pre></div>
<p>Choosing a prior on (<span class="math inline">\(K\)</span>). The
number of clusters is unknown. on (K) to let the data negotiate between
parsimony (few blocks) and expressiveness (many blocks). This also curbs
the classic tendency of mixture-like models to over-split when data are
noisy.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Gnedin model chosen (Other possible choices "DM", "PY", "DP")</span></span>
<span><span class="va">prior</span> <span class="op">=</span> <span class="st">'GN'</span></span>
<span><span class="va">gamma_GN</span> <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">w_ij</span><span class="op">)</span></span>
<span><span class="co">#check E[K | gamma, n]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/gnedin_K_mean.html">gnedin_K_mean</a></span><span class="op">(</span><span class="va">n</span>,<span class="va">gamma_GN</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#check Var[K | gamma, n]</span></span>
<span><span class="fu"><a href="../reference/gnedin_K_var.html">gnedin_K_var</a></span><span class="op">(</span><span class="va">n</span>,<span class="va">gamma_GN</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 45.95132</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="run-the-clustered-gibbs-sampler-short-chain">Run the clustered Gibbs sampler (short chain)<a class="anchor" aria-label="anchor" href="#run-the-clustered-gibbs-sampler-short-chain"></a>
</h3>
<p>We now draw samples from the joint posterior distribution using a
collapsed Gibbs sampler. In this simplified demonstration the chain
length is intentionally short; in empirical applications, longer runs or
parallel chains are recommended.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">T_iter</span> <span class="op">=</span> <span class="fl">10000</span> <span class="co">#for real use set it to 30,000</span></span>
<span><span class="va">T_burn</span> <span class="op">=</span> <span class="fl">2000</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">BTSBM</span><span class="fu">::</span><span class="fu"><a href="../reference/gibbs_bt_sbm.html">gibbs_bt_sbm</a></span><span class="op">(</span></span>
<span>  w_ij   <span class="op">=</span> <span class="va">w_ij</span>,</span>
<span>  a <span class="op">=</span> <span class="va">a_strength</span>,</span>
<span>  prior  <span class="op">=</span> <span class="va">prior</span>,       <span class="co"># "DP", "PY", "DM", or "GN"</span></span>
<span>  gamma_GN <span class="op">=</span>  <span class="va">gamma_GN</span>,</span>
<span>  T_iter <span class="op">=</span> <span class="va">T_iter</span>, </span>
<span>  T_burn <span class="op">=</span> <span class="va">T_burn</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; iter 1000 occupied = 4 </span></span>
<span><span class="co">#&gt; iter 2000 occupied = 7 </span></span>
<span><span class="co">#&gt; iter 3000 occupied = 7 </span></span>
<span><span class="co">#&gt; iter 4000 occupied = 5 </span></span>
<span><span class="co">#&gt; iter 5000 occupied = 4 </span></span>
<span><span class="co">#&gt; iter 6000 occupied = 5 </span></span>
<span><span class="co">#&gt; iter 7000 occupied = 4 </span></span>
<span><span class="co">#&gt; iter 8000 occupied = 7 </span></span>
<span><span class="co">#&gt; iter 9000 occupied = 7 </span></span>
<span><span class="co">#&gt; iter 10000 occupied = 3</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="relabel-and-summarize">Relabel and summarize<a class="anchor" aria-label="anchor" href="#relabel-and-summarize"></a>
</h3>
<p>The posterior distribution of latent block-assignments is invariant
under permutations of cluster labels. Consequently, averaging or
summarizing raw samples is meaningless without post-processing.
Relabeling methods align label permutations across iterations, enabling
consistent summaries of cluster-specific parameters.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu">BTSBM</span><span class="fu">::</span><span class="fu"><a href="../reference/relabel_by_lambda.html">relabel_by_lambda</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">x_samples</span>, <span class="va">out</span><span class="op">$</span><span class="va">lambda_samples</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pretty table of the K posterior distribution</span></span>
<span><span class="fu"><a href="../reference/pretty_table_K_distribution.html">pretty_table_K_distribution</a></span><span class="op">(</span><span class="va">post</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
7
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
0.152
</td>
<td style="text-align:right;">
0.302
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
0.164
</td>
<td style="text-align:right;">
0.076
</td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="obtain-point-estimates">Obtain point estimates<a class="anchor" aria-label="anchor" href="#obtain-point-estimates"></a>
</h3>
<p>Partition estimates such as the Binder or Minimum Variation of
Information (MinVI) losses are the state-of-the-art point estimate
methods for partition samples. Binder’s loss tends to favor slightly
finer partitions, while MinVI is more conservative. Comparing these
estimates provides insight into the stability of the inferred grouping
structure.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_binder</span> <span class="op">&lt;-</span> <span class="va">post</span><span class="op">$</span><span class="va">partition_binder</span> <span class="co">#partition with Binder loss</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x_binder</span><span class="op">)</span> <span class="co">#Block sizes</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; x_binder</span></span>
<span><span class="co">#&gt;  1  2  3  4 </span></span>
<span><span class="co">#&gt;  2 17 12 74</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_minVI</span> <span class="op">&lt;-</span> <span class="va">post</span><span class="op">$</span><span class="va">minVI_partition</span> <span class="co">#partition with MIN-VI loss</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x_minVI</span><span class="op">)</span> <span class="co">#Block sizes</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; x_minVI</span></span>
<span><span class="co">#&gt;  1  2  3 </span></span>
<span><span class="co">#&gt;  2 21 82</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="plot-reordered-adjacency-matrix">Plot reordered adjacency matrix<a class="anchor" aria-label="anchor" href="#plot-reordered-adjacency-matrix"></a>
</h3>
<p>The reordered adjacency matrix reveals the empirical interaction
pattern between inferred blocks. Dark-green colour in the right
off-diagonal region correspond to high winning proportions, while
uniform colours along the main diagonal indicate balanced
competitiveness within clusters. This visualization serves as a
qualitative validation of the inferred block structure.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_block_adjacency.html">plot_block_adjacency</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">post</span>,</span>
<span>                     w_ij <span class="op">=</span> <span class="va">w_ij</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-7-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="plot-assignment-uncertainty">Plot assignment uncertainty<a class="anchor" aria-label="anchor" href="#plot-assignment-uncertainty"></a>
</h3>
<p>Posterior probabilities of assignment <span class="math inline">\(p(x_i = k | W)\)</span> quantify the uncertainty
of player-to-block allocations. High uncertainty for certain individuals
typically signals boundary cases or transitional players whose
performance profile lies between different clusters.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_assignment_probabilities.html">plot_assignment_probabilities</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">post</span>, w_ij <span class="op">=</span> <span class="va">w_ij</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-8-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="plot-lambda-uncertainty">Plot lambda uncertainty<a class="anchor" aria-label="anchor" href="#plot-lambda-uncertainty"></a>
</h3>
<p>Posterior uncertainty in <span class="math inline">\(\lambda_{x_i}\)</span>, the strength of player i.
Since all players assigned to the same block share the same <span class="math inline">\(\lambda\)</span>, the uncertainty here is driven
by the assignment uncertainty. Reporting credible intervals gives a
precise idea of the relative strength differences between clusters, and
between players as well.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_lambda_uncertainty.html">plot_lambda_uncertainty</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">post</span>, w_ij <span class="op">=</span> <span class="va">w_ij</span>, clean_fun <span class="op">=</span> <span class="va">clean_players_names</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-9-1.png" width="960" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lapo Santi.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
